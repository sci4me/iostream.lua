<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>iostream.lua documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>iostream.lua</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>



<h2>Examples</h2>
<ul class="nowrap">
  <li><strong>iostream_spec.lua</strong></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/BufferedInputStream.html">BufferedInputStream</a></li>
  <li><a href="../modules/BufferedOutputStream.html">BufferedOutputStream</a></li>
  <li><a href="../modules/ByteArrayInputStream.html">ByteArrayInputStream</a></li>
  <li><a href="../modules/ByteArrayOutputStream.html">ByteArrayOutputStream</a></li>
  <li><a href="../modules/DataInputStream.html">DataInputStream</a></li>
  <li><a href="../modules/DataOutputStream.html">DataOutputStream</a></li>
  <li><a href="../modules/FileInputStream.html">FileInputStream</a></li>
  <li><a href="../modules/FileOutputStream.html">FileOutputStream</a></li>
  <li><a href="../modules/InputStream.html">InputStream</a></li>
  <li><a href="../modules/OutputStream.html">OutputStream</a></li>
  <li><a href="../modules/StringInputStream.html">StringInputStream</a></li>
  <li><a href="../modules/StringOutputStream.html">StringOutputStream</a></li>
  <li><a href="../modules/iostream.html">iostream</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/README.md.html">README</a></li>
</ul>

</div>

<div id="content">

    <h2>iostream_spec.lua</h2>
<pre>
<span class="comment">-- luacheck: push no unused
</span>
<span class="keyword">local</span> <span class="global">assert</span>    = <span class="global">require</span> <span class="string">"luassert"</span>
<span class="keyword">local</span> char      = <span class="global">string</span>.char
<span class="keyword">local</span> byte      = <span class="global">string</span>.byte
<span class="keyword">local</span> substr    = <span class="global">string</span>.sub
<span class="keyword">local</span> strlen    = <span class="global">string</span>.len

<span class="keyword">local</span> path_separator    = substr(<span class="global">package</span>.config, <span class="number">1</span>, <span class="number">1</span>)
<span class="keyword">local</span> is_windows        = path_separator == <span class="string">'\\'

describe("iostream.lua", function()
    local iostream
    local InputStream
    local OutputStream
    local StringInputStream
    local StringOutputStream
    local ByteArrayInputStream
    local ByteArrayOutputStream
    local FileInputStream
    local FileOutputStream
    local BufferedInputStream
    local BufferedOutputStream
    local DataInputStream
    local DataOutputStream

    local to_be_deleted = {}

    teardown(function()
        for i = 1, #to_be_deleted do
            os.remove(to_be_deleted[i])
        end
    end)

    local function tmpname()
        local path = os.tmpname()
        if is_windows and not path:find('</span>:') <span class="keyword">then</span>
            path = <span class="global">os</span>.getenv(<span class="string">"TEMP"</span>) .. path
        <span class="keyword">end</span>
        to_be_deleted[#to_be_deleted + <span class="number">1</span>] = path
        <span class="keyword">return</span> path
    <span class="keyword">end</span>

    it(<span class="string">"loads"</span>, <span class="keyword">function</span>()
        iostream = <span class="global">require</span> <span class="string">"iostream"</span>
        InputStream = iostream.InputStream
        OutputStream = iostream.OutputStream
        StringInputStream = iostream.StringInputStream
        StringOutputStream = iostream.StringOutputStream
        ByteArrayInputStream = iostream.ByteArrayInputStream
        ByteArrayOutputStream = iostream.ByteArrayOutputStream
        FileInputStream = iostream.FileInputStream
        FileOutputStream = iostream.FileOutputStream
        BufferedInputStream = iostream.BufferedInputStream
        BufferedOutputStream = iostream.BufferedOutputStream
        DataInputStream = iostream.DataInputStream
        DataOutputStream = iostream.DataOutputStream
    <span class="keyword">end</span>)

    describe(<span class="string">"StringInputStream"</span>, <span class="keyword">function</span>()
        it(<span class="string">"works"</span>, <span class="keyword">function</span>()
            <span class="keyword">local</span> str = <span class="string">"foobar123"</span>

            <span class="keyword">local</span> s = StringInputStream(str)

            <span class="keyword">for</span> i = <span class="number">1</span>, strlen(str) <span class="keyword">do</span>
                <span class="global">assert</span>.are.equal(s:readU8(), byte(substr(str, i, i)))
            <span class="keyword">end</span>
            <span class="global">assert</span>.are.equal(s:readU8(), <span class="keyword">nil</span>)
        <span class="keyword">end</span>)
    <span class="keyword">end</span>)

    describe(<span class="string">"StringOutputStream"</span>, <span class="keyword">function</span>()
        it(<span class="string">"works"</span>, <span class="keyword">function</span>()
            <span class="keyword">local</span> str = <span class="string">"foobar123"</span>

            <span class="keyword">local</span> s = StringOutputStream()

            <span class="keyword">for</span> i = <span class="number">1</span>, strlen(str) <span class="keyword">do</span>
                s:writeU8(byte(substr(str, i, i)))
            <span class="keyword">end</span>

            <span class="global">assert</span>.are.equal(s:toString(), str)
        <span class="keyword">end</span>)
    <span class="keyword">end</span>)

    describe(<span class="string">"ByteArrayInputStream"</span>, <span class="keyword">function</span>()
        it(<span class="string">"works"</span>, <span class="keyword">function</span>()
            <span class="keyword">local</span> data = { <span class="number">0</span>, <span class="number">1</span>, <span class="number">250</span>, <span class="number">170</span>, <span class="number">66</span>, <span class="number">92</span>, <span class="number">255</span>, <span class="number">42</span> }

            <span class="keyword">local</span> s = ByteArrayInputStream(data)

            <span class="keyword">for</span> i = <span class="number">1</span>, #data <span class="keyword">do</span>
                <span class="global">assert</span>.are.equal(s:readU8(), data[i])
            <span class="keyword">end</span>
            <span class="global">assert</span>.are.equal(s:readU8(), <span class="keyword">nil</span>)
        <span class="keyword">end</span>)
    <span class="keyword">end</span>)

    describe(<span class="string">"ByteArrayOutputStream"</span>, <span class="keyword">function</span>()
        it(<span class="string">"works"</span>, <span class="keyword">function</span>()
            <span class="keyword">local</span> data = { <span class="number">0</span>, <span class="number">1</span>, <span class="number">250</span>, <span class="number">170</span>, <span class="number">66</span>, <span class="number">92</span>, <span class="number">255</span>, <span class="number">42</span> }

            <span class="keyword">local</span> s = ByteArrayOutputStream(data)

            <span class="keyword">for</span> i = <span class="number">1</span>, #data <span class="keyword">do</span>
                s:writeU8(data[i])
            <span class="keyword">end</span>

            <span class="keyword">local</span> r = s:toByteArray()
            <span class="global">assert</span>.are.equal(#r, #data)
            <span class="keyword">for</span> i = <span class="number">1</span>, #r <span class="keyword">do</span>
                <span class="global">assert</span>.are.equal(r[i], data[i])
            <span class="keyword">end</span>
        <span class="keyword">end</span>)
    <span class="keyword">end</span>)

    describe(<span class="string">"FileInputStream"</span>, <span class="keyword">function</span>()
        <span class="keyword">local</span> data = { <span class="number">0</span>, <span class="number">1</span>, <span class="number">250</span>, <span class="number">170</span>, <span class="number">66</span>, <span class="number">92</span>, <span class="number">255</span>, <span class="number">42</span> }
        <span class="keyword">local</span> path = tmpname()

        <span class="keyword">local</span> fh = <span class="global">io</span>.open(path, <span class="string">"wb"</span>)
        <span class="keyword">for</span> i = <span class="number">1</span>, #data <span class="keyword">do</span>
            fh:write(char(data[i]))
        <span class="keyword">end</span>
        fh:close()

        <span class="keyword">local</span> s = FileInputStream(path)

        <span class="keyword">for</span> i = <span class="number">1</span>, #data <span class="keyword">do</span>
            <span class="global">assert</span>.are.equal(s:readU8(), data[i])
        <span class="keyword">end</span>
        <span class="global">assert</span>.are.equal(s:readU8(), <span class="keyword">nil</span>)
        s:close()
    <span class="keyword">end</span>)

    describe(<span class="string">"FileOutputStream"</span>, <span class="keyword">function</span>()
        it(<span class="string">"works"</span>, <span class="keyword">function</span>()
            <span class="keyword">local</span> data = { <span class="number">0</span>, <span class="number">1</span>, <span class="number">250</span>, <span class="number">170</span>, <span class="number">66</span>, <span class="number">92</span>, <span class="number">255</span>, <span class="number">42</span> }
            <span class="keyword">local</span> path = tmpname()

            <span class="keyword">local</span> s = FileOutputStream(path)

            <span class="keyword">for</span> i = <span class="number">1</span>, #data <span class="keyword">do</span>
                s:writeU8(data[i])
            <span class="keyword">end</span>
            s:close()

            <span class="keyword">local</span> fh = <span class="global">io</span>.open(path, <span class="string">"rb"</span>)
            <span class="keyword">for</span> i = <span class="number">1</span>, #data <span class="keyword">do</span>
                <span class="global">assert</span>.are.equal(byte(fh:read(<span class="number">1</span>)), data[i])
            <span class="keyword">end</span>
            fh:close()
        <span class="keyword">end</span>)
    <span class="keyword">end</span>)
<span class="keyword">end</span>)

<span class="comment">-- luacheck: pop</span></pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2021-01-11 22:05:23 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
